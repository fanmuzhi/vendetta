## SSC_drva_test

#### ssc_drva_test:

- Command line _execute tool introduced to _execute driver features at Sensor API.
- Command syntax:

```shell
adb shell ssc_drva_test -sensor=<value> -duration=<value> -sample_rate=<value> -batch_period=<value> -fifo=<value> -batch_count=<value> -stop_n_go=<value> -delay=<value> -flush_fill=<value> -seed=<value>          -iterations=<value> -num_samples=<value> -dri=<value> -factory_test=<value>  -verbose=<value> -debug
```


| Tags         | Type             | Value Range /   Valid input                                                                                                                                                                                                                                                                                    | Units                      | Notes                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| -------------- | ------------------ | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| sensor       | string           | "accel"<br/>"gyro"<br/>"sensor_temperature"       "pressure"<br/>"mag"<br/>"humidity"<br/>"ambient_temperature"<br/>"ultra_violet"<br/>"proximity"<br/>"ambient_light"<br/>"proximity"<br/>"rgb"<br/>"hall"<br/>"motion_detect"                                                                                | Not   Applicable           | Mandatory   parameter. Must one of the supported values listed in the valid input column.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| sample_rate  | float            | "-1": “max sampling rate”<br/>"-2": min Sampling rate<br/>"-3" or "-3.0": ODR Sweep low to high frequency;   <br/>"-3.1": ODR Sweep high to low frequency<br/>"-3.2": ODR Sweep randomly using each frequency at-least once   <br/>"-4": Randomly generated frequency between 0 and Max supported frequency. | Hz or samples   per second | Mandatory for   streaming sensor type if request is not defining factory _execute. Not used for   other sensor types.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| batch_period | float            | only + values                                                                                                                                                                                                                                                                                                  | seconds                    | Optional   parameter. This is same as batch period or report period.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| batch_count  | int              | only + values                                                                                                                                                                                                                                                                                                  | Not   Applicable           | Optional   parameter. Shall not be used unless batch period is defined. Indicates the   number of time a batch of samples is expected. calculates the _execute duration   as "batch_count * batch_period".                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| fifo         | int              | both + and -   values                                                                                                                                                                                                                                                                                          | percentage or   samples    | Optional   parameter. Alternative way to define the used batch period. When this   parameter is used, the batch period is calculated based on the requested FiFo   fullness level for each batch or number of samples in each batch.    Using this   option calculates a batch period to maintain a FiFo fullness based. using +   values indicate % fullness of FiFo - value indicates #of samples using   this option overrides any batch_period specified.                                                                                                                                                                                                                                                                   |
| flush_fill   | int              | both   "+" and "- "values                                                                                                                                                                                                                                                                                      | percentage                 | Optional   parameter. Shall be used only in case of batching. The used batch period   shall be defined using FiFo parameter. The flush fill level defined when an   explicit flush command is sent to the sensor driver.   Example:   -fifo=50 -flush_fill=80 this means that a batch period is calculated to   maintain a fifo fullness of 50% at the sensor. here flush_fill means when 80%   of desired fullness is reached a flush request will be sent out. In numbers   if sampling rate is 1 Hz. and the fifo depth is 100 samples a batch period of   50% => 50seconds will be used and flush request is sent out every 40(80%   of 50seconds) seconds.   -1 ->   random between 0-95%   -2   ->random between 0- 100 % |
| num_samples  | int              | only + values                                                                                                                                                                                                                                                                                                  | Not   Applicable           | Optional   parameter. num_samples indicate minimum number of samples desired to be   collected. If this parameter is specified and if the _execute does not collect   enough samples during the _execute a "FAIL" is generated by the _execute   sensor.   This   parameter forces the _execute to run for a maximum duration between:   1)   specified duration or   2) duration   calculated by num_samples * expected sample rate. Where expected sample rate   is the rate which sensor is expected to serve at.                                                                                                                                                                                                            |
| sensor_name  | string           | can take mfg.   name string such as LSM6DSM etc.                                                                                                                                                                                                                                                               | Not   Applicable           | Optional   parameter. Case-insensitive and is used to _execute a particular sensor if more   than one of same data type is present. Eg.: choosing   "sensor_temperature" of "Sensor A" when both "Sensor A" and "Sensor   B" is present.   *   -sensor_name and -dri need to be used in conjunction else a default dri=0 is   used                                                                                                                                                                                                                                                                                                                                                                                              |
| dri          | int              | value of   either 0 or 1                                                                                                                                                                                                                                                                                       | Not   Applicable           | Optional   parameter. Switch to choose between dri or polling version of the same sensor   if supported by   the sensor.   Streaming   variant: -dri=0    On change   variant: -dri=1    *-sensor_name   and -dri need to be used in conjunction else a default dri=0 is used                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| factory_test | int              | Software   = 0, self_test<br /><br />Hardware   = 1, self_test   <br /><br />Factory   = 2, calibration   <br /><br />Comm   = 3                                                                                                                                                                               | Not   Applicable           | Optional   parameter. Selects the level of factory _execute you want to run.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| duration     | float            | only   positive values                                                                                                                                                                                                                                                                                         | seconds                    | Mandatory   Parameter. Determines the length of tests.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| delay        | float            | both   + and - values                                                                                                                                                                                                                                                                                          | seconds                    | Optional   Parameter. Delays the start of _execute execution by specified duration if its   "+" otherwise for "-" values delays the _execute with a   random duration between 0 and\|delay\|.   Please   note the "delay" here eats up from the overall _execute   "duration". so, it’s important for the user to enter a _execute   duration higher than the "delay" specified. if the user specifies a   random delay then its recommended that they specify a duration larger than   the \|delay\|. The user might see "Timeout" if the above   conditions are not satisfied.                                                                                                                                               |
| stop_n_go    | int              | both   + and - values                                                                                                                                                                                                                                                                                          | seconds                    | Optional   Parameter. Defines _execute mode where multiple back to back streaming or   batching requests are repeated. The stop_n_go duration defines the duration   of the individual request. ex: -duration=60 -stop_n_go=5 the _execute will run   for 60 seconds but the sensors will stream and stop for 5 seconds respectively.   if a "-" values is used then a random value is selected between 0   and\|stop_n_go\|.                                                                                                                                                                                                                                                                                                   |
| iterations   | int              | only   + values                                                                                                                                                                                                                                                                                                | Not   Applicable           | Optional   parameter. Provides the number of times the _execute needs to be repeated                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| seed         | int              | only   + values                                                                                                                                                                                                                                                                                                | Not   Applicable           | Optional   parameter. The used seed for random number generator. This allows running   randomized _execute cases with deterministic sequence. If seed is not provided,   an unique seed based on current time is used.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| verbose      | int              | value   of either 1 or 2                                                                                                                                                                                                                                                                                       | Not   Applicable           | Optional   parameter. Enables the printing of F3 msgs. from da_test on QXDM.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| debug        | Not   Applicable | Not   Applicable                                                                                                                                                                                                                                                                                               | Not   Applicable           | Optional   parameter. Enables debug information from the ssc_drva_test                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |

#### Examples:

##### How to stream single sensor at selected sampling frequency for known duration

```shell
adb shell ssc_drva_test -sensor=accel -duration=30 -sample_rate=100
```

This will stream Accelerometer for 30 seconds with a sampling rate of 100Hz.

##### How to batch single sensor at selected sampling frequency and report period for known duration

```shell
adb shell ssc_drva_test -sensor=accel -duration=30.0 -sample_rate=100 -batch_period=2.0
```

This will be creating a streaming request for accelerometer with sampling rate of 10Hz and batch_period of 2 seconds.

##### How to batch single sensor at selected sampling frequency and FiFo fill level for known duration

```shell
adb shell ssc_drva_test -sensor=accel -duration=30.0 -sample_rate=100 -fifo=50
```

If the accelerometers maximum FiFo size is 208 samples, the above would result a batch_period of 208/100s * 50% = 1.04 seconds at sampling rate of 100Hz. The streaming will last 30 seconds.

##### How to stream 2 or more sensors concurrently

```shell
adb shell "ssc_drva_test -sensor=accel -duration=60.0 -sample_rate=100 &" "ssc_drva_test -sensor=gyro -duration=60.0 -sample_rate=50 -delay=5" 
```

The above command can be used to exercise two different sensors simultaneously. It will stream Accelerometer for 60 seconds at 100Hz sampling rate along with Gyroscope at sample rate of 50 Hz. It also delays the Gyro streaming by 5.0 seconds there by effectively streaming it for 55.0 seconds.

##### How to batch 2 or more sensors concurrently

```shell
adb shell "ssc_drva_test -sensor=accel -duration=60.0 -sample_rate=100 -batch_period=2.0 &" "ssc_drva_test -sensor=gyro -duration=60.0 -sample_rate=50 -batch_period=4.2"
```

This will stream Accelerometer and gyro for a duration of 6.0 seconds concurrently while using a sample rate of 100Hz and 50Hz respectively, but it will be using a batch period of 2.0 seconds for Accelerometer and batch period of 4.2 seconds for Gyro.

##### 5How to stream 1 sensor and batch another concurrently

```shell
adb shell "ssc_drva_test -sensor=accel -duration=60.0 -sample_rate=100 -batch_period=2.0 &" "ssc_drva_test -sensor=gyro -duration=60.0 -sample_rate=50" 
```

The command above will stream Accelerometer and Gyro for 60.0 seconds with a sampling rate of 100Hz and 50Hz respectively. Additionally, a batch period of 2.0 seconds is used for the Accelerometer.

##### How to choose a sensor from multiple types based on name

```shell
adb shell ssc_drva_test -duration=10 -sample_rate=-1 -sensor=sensor_temperature -sensor_name=<Sensor A> -dri=0
```

If there are multiple sensors of same type present in the system this command can be used to choose the desired sensor based on sensor_name attribute. This command will stream sensor_temperature of "Sensor A" for 10.0 seconds at its maximum supported sampling rate. If the "dri" option is not specified a default of "-dri=0" is used.

##### How to run odr sweep

```shell
adb shell ssc_drva_test -duration=10 -sample_rate=-3 -sensor=accel
```

This will stream Accelerometer for 10 seconds on each of its supported sampling rates, starting from the lowest rate. If there are 4 sampling rates supported, the overall _execute duration will be 40 seconds.
